<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>서민관 작업 구역</title>
</head>

<style>
    #alert{
        color: red;
        margin-bottom: 20px;

    }
    .MGSection {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 8px 8px rgba(0, 0, 0, 0.1);
        text-align: center;
    }
    #head {
        font-size: 1.5em;
        font-weight: bold;
        margin-bottom: 20px;
        color: #0023ff;
    }
    .col {
        width: 30px;
        height: 30px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1em;
        font-weight: bold;
        border: 1px solid #eee;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .clicked{
        background-color: #00ff58;
    }
    .game_board {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        gap: 10px;
        margin-bottom: 10px;
    }
    .row{
        display: flex;
        gap: 5px;
    }
</style>

<body>

<div class="MGSection">
    <div id="head"></div>
    <div id="alert"></div>
    <div id="game_board" class="game_board"></div>

    <button id="reset_btn">게임 초기화</button>
    <div id="stats">
        틀린 횟수: <span id="err_count">0</span>
    </div>
</div>

<script>
    let n = 0; // 뭐?
    let m = 0; // 틀린 횟수
    const head = document.getElementById('head');
    const gameBoard = document.getElementById('game_board');
    const errCount = document.getElementById('err_count');
    const resetBtn = document.getElementById('reset_btn');
    const Alert = document.getElementById('alert');

    function viewNum(){
        const colNum = gameBoard.querySelectorAll('.col');
        let totalNum = 0;

        for(const col of colNum){
            if(parseInt(col.innerHTML) === n && !col.className.includes('clicked')){
                totalNum++;
            }
        }
        Alert.innerText = ` ${totalNum}개 남았습니다`;
    }

    function getRandomNum(max) {
        return Math.floor(Math.random() * (max + 1));
    }

    /**
     * 게임을 초기 상태로 되돌림
     */
    function startGame() {
        n = getRandomNum(9);
        m = 0;
        updateErrNum();
        viewNum();
        head.textContent = `숫자 ${n}을(를) 모두 찾아서 클릭하세요.`;

        gameBoard.innerHTML = '';

        // 게임 보드에 0~9 랜덤 숫자출력
        for (let i = 0; i < 6; i++) {
            const row = document.createElement('div');
            row.className = 'row';

            for(let j = 0; j < 10; j++){
                const col = document.createElement('div');
                col.className = 'col';
                col.textContent = getRandomNum(9);
                col.addEventListener('click', addClickEvent);

                row.append(col);
            }
            gameBoard.append(row);
        }
        viewNum();

    }

    /**
     * 틀린 횟수 m을 화면에 출력
     */
    function updateErrNum() {
        errCount.textContent = m;
    }


    /**
     * .col 클릭 이벤트
     */
    function addClickEvent(e) {
        const clickedCol = e.target;

        const clickedNumber = parseInt(clickedCol.textContent);

        if (clickedNumber === n) {
            clickedCol.classList.add('clicked');

            if (checkComGame()) {
                removeClickEvent();
                setTimeout(()=>{
                    alert(`축하합니다! 숫자 ${n}을(를) 모두 찾았습니다!\n틀린 횟수: ${m}번`);
                    viewNum();
                    }, 0);
            }

        } else {
            alert("틀린 숫자를 클릭했습니다");
            m++;
            updateErrNum();
        }
    }

    /**
     * 게임판에 n과 일치하지만 아직 클릭되지 않은 셀이 남아있는지 확인
     */
    function checkComGame() {
        const cols = gameBoard.querySelectorAll('.col');
        for (const col of cols) {
            const colValue = parseInt(col.textContent);

            // col 숫자가 n과 같고 col의 클래스 명이 clicked인게 있니? 있으면 게임을 계속 진행
            if (colValue === n && !col.className.includes('clicked')) {
                viewNum();
                return false;
            }
        }
        return true;
    }

    /**
     * 게임 완료 시 .col 클릭 이벤트 제거
     */
    function removeClickEvent() {
        const cols = gameBoard.querySelectorAll('.col');
        cols.forEach(c => {
            c.removeEventListener('click', addClickEvent);
        });
    }

    resetBtn.addEventListener('click', () => {
        startGame();
    });

    startGame();
</script>

</body>
</html>